
<!doctype html>
<html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>MQTT PSK Reporter Map</title>
<style>
  html, body { height: 100%; margin: 0; }
  .overlay {
    position: absolute;
    top: 10px;
    right: 10px;   /* move legend to top-right */
    left: auto;    /* disable the left anchor */
    background: rgba(255,255,255,0.9);
    border-radius: 8px;
    padding: 8px 12px;
    font-family: system-ui, sans-serif;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    z-index: 9999;
    max-width: 320px;
  }
  .overlay .stat { font-size: 12px; opacity: 0.8; }
  .overlay .title { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
  .legend { margin-top: 6px; font-size: 12px; }
</style>
</head><body>
{{ folium_map|safe }}

<!-- Leaflet.markercluster (after Folium's Leaflet is loaded) -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
/>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
/>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<!-- Simple legend -->
<div class="overlay" style="max-width:280px;line-height:1.2">
  <div><strong>Live Spots:</strong> <span id="count">0</span></div>
  <div style="margin-top:6px">
    <small><strong>Band colors</strong></small><br/>
    <small>
      <span style="display:inline-block;width:10px;height:10px;background:#6b7280;border-radius:2px;margin-right:4px"></span>160m
      <span style="display:inline-block;width:10px;height:10px;background:#8b5cf6;border-radius:2px;margin:0 4px 0 8px"></span>80m
      <span style="display:inline-block;width:10px;height:10px;background:#ef4444;border-radius:2px;margin:0 4px 0 8px"></span>60m
      <span style="display:inline-block;width:10px;height:10px;background:#f59e0b;border-radius:2px;margin:0 4px 0 8px"></span>40m
      <span style="display:inline-block;width:10px;height:10px;background:#10b981;border-radius:2px;margin:0 4px 0 8px"></span>30m
      <span style="display:inline-block;width:10px;height:10px;background:#3b82f6;border-radius:2px;margin:0 4px 0 8px"></span>20m
      <span style="display:inline-block;width:10px;height:10px;background:#0ea5e9;border-radius:2px;margin:0 4px 0 8px"></span>17m
      <span style="display:inline-block;width:10px;height:10px;background:#22c55e;border-radius:2px;margin:0 4px 0 8px"></span>15m
      <span style="display:inline-block;width:10px;height:10px;background:#a855f7;border-radius:2px;margin:0 4px 0 8px"></span>12m
      <span style="display:inline-block;width:10px;height:10px;background:#e11d48;border-radius:2px;margin:0 4px 0 8px"></span>10m
      <span style="display:inline-block;width:10px;height:10px;background:#84cc16;border-radius:2px;margin:0 4px 0 8px"></span>6m
      <span style="display:inline-block;width:10px;height:10px;background:#06b6d4;border-radius:2px;margin:0 4px 0 8px"></span>2m
    </small>
  </div>
</div>

<script>
  window._folium_map = window._folium_map || (function(){
    for(const k in window){
      const obj=window[k];
      if(k.startsWith("map_") && obj && typeof obj.addLayer==="function"){
        console.log("Detected Folium Leaflet map:",k);
        return obj;
      }
    }
    console.warn("Could not locate Folium map object");
    return null;
  })();
</script>
<div class="overlay">Live Spots: <span id="count">0</span></div>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>
<script src="/static/client.js"></script>
</body></html>
